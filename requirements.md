# HP（疲労度）管理による業務効率化支援アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 アプリケーション名
**HP Planner** - 疲労度管理による業務効率化＆ウェルビーイング支援アプリ

### 1.2 開発背景・目的
**Google Cloud Japan AI Hackathon Vol.3**（テーマ：「現実を豊かにするAI Agent」）への提出作品として開発。

見えない疲労（HP）を可視化・管理することで、集中力・満足度・生産性の向上を図り、効率的な会議運営とワークライフバランスの改善を支援する。AI Agentが現実の業務環境を豊かにし、人間の意思決定を支援する具体例を示す。

### 1.3 ハッカソン要件適合
- **開催期間**: 2025年8月5日 - 9月24日
- **テーマ**: "AI Agents Enriching Reality" - 現実を豊かにするAI Agent
- **Google Cloud要件**: Cloud Functions, Firestore使用
- **Google AI要件**: Vertex AI Gemini使用
- **総賞金**: ¥1,750,000（最優秀賞¥500,000、優秀賞¥250,000×5）

### 1.4 対象領域
- **ジャンル**: 業務効率化 × ウェルビーイング × コラボレーション支援
- **分野**: 会議支援/スケジューリング最適化

### 1.5 解決する課題
1. 見えない疲労（HP）による集中力・満足度・生産性の低下
2. 予定調整の非効率・不公平性
3. 不必要に長い会議や冗長な打ち合わせ

## 2. ターゲットユーザー

### 2.1 主要ユーザー層
- ナレッジワーカー
- プロジェクトマネージャー
- チームマネージャー
- リモートワーカー

### 2.2 導入想定
- **初期**: 3-10名の小チームでの先行導入
- **展開**: 部署・組織レベルでの段階的拡張

## 3. 機能要件

### 3.1 HP（疲労度）システム

#### 3.1.1 HP基本仕様
- **数値範囲**: 0-100（整数）
- **初期値**: 朝06:00時点で天気から算出、最低30でクリップ
- **自然減衰**: 0.5ポイント/15分（=2ポイント/時間）

#### 3.1.2 HP回復システム
- **マイクロブレイク（5分）**: +5ポイント
- **休憩（10分）**: +10ポイント
- **ランチ（45-60分）**: +15ポイント（自動挿入なし、手動設定時適用）
- **上限**: 100ポイント

#### 3.1.3 HP減少計算式
15分スロットごとに以下の式で更新：

```
HP(t+15) = clamp(
  HP(t) - [
    自然減0.5
    + 会議コスト(type係数 × 長さ係数 × 人数係数)
    + 曖昧さ係数(vagueScore)
    + 文脈切替ペナルティ(1-similarity)×e
    + 移動ペナルティ(travelMin/10)×d
  ] + 休憩回復,
  0, 100
)
```

#### 3.1.4 減少係数（初期値）
- **type係数（/15分）**:
  - 決定: 2.0, ブレスト: 2.5, 報告: 1.0, 1on1: 1.5
  - 企画/レビュー: 2.0, 面談: 2.8, ワークショップ: 2.2
  - 雑談: 0.8, 作業: 1.2
- **長さ係数**: 1 + (会議合計分/60) × 0.2
- **人数係数**: max(0, 参加者-2) × 0.2（上限+1.6、10人まで）
- **曖昧さ係数**: vagueScore × 1.5
- **文脈切替係数e**: 1.0
- **移動係数d**: 0.4

### 3.2 天気連携機能

#### 3.2.1 ベースHP算出式
```
HP_base = clamp(
  100
  - max(0, tmax-30) × 1.2
  - max(0, 18-tmin) × 0.5
  - (rainProbMax/100) × 10,
  30, 100
)
```

#### 3.2.2 天気データソース
- **API**: Open-Meteo（APIキー不要）
- **更新頻度**: 1日1回（朝06:00）

### 3.3 AI Agent機能

#### 3.3.1 HPプランナー
- **機能**: 天気条件から今日のHP初期値を自動決定
- **出力**: ベースHP値 + 理由説明文（Gemini生成）

#### 3.3.2 会議メタ推定エージェント
**入力**: 会議タイトル、説明文、参加者情報
**出力スキーマ**:
```json
{
  "type": "決定|ブレスト|報告|1on1|レビュー|企画|面談|ワークショップ|雑談|作業",
  "vagueScore": 0.0-1.0,
  "syncNecessity": 0.0-1.0,
  "prepMinutes": 整数,
  "tags": ["採用", "障害", "予算", "..."]
}
```
**MVP使用項目**: type, vagueScore, syncNecessity

#### 3.3.3 会議ナビゲータ
- **機能**: 参加者HP状況と会議内容を考慮した最適化提案
- **MVP提案内容**:
  - 時間短縮（50→25分、30→20分）
  - 一部非同期化（報告パート事前ドキュメント化）
- **判定条件**: syncNecessity < 0.6 で提案しやすい

#### 3.3.4 ブレイク・インサータ
- **機能**: HP閾値到達前の自動休憩提案
- **閾値設定**:
  - **注意**: HP ≤ 40% → 5分休憩提案トースト
  - **警告**: HP ≤ 25% → 10分休憩.ics自動生成＆提示
  - **危険**: HP ≤ 10% → 会議短縮/非同期化提案

### 3.4 Chrome拡張機能

#### 3.4.1 UI仕様
- **メイン表示**: 右下HPリング（%表示）+ 時刻サブテキスト
- **設定**: ⚙オプションボタン
- **提案表示**: 閾値到達時のトースト通知

#### 3.4.2 ユーザーアクション
- **休憩挿入**: 「5分休憩を差し込む（.ics）」ボタン
- **会議調整**: 「会議25分短縮提案」ボタン（下書きクリップボード）

#### 3.4.3 更新頻度
- **HP再評価**: 60秒ごとのポーリング
- **通知タイミング**: 
  - 閾値30分前に1回
  - 未実施時15分前に再提示（スパム防止）

### 3.5 データ入力（MVP）
- **手動入力**: 不要（天気＋自然減のみで動作）
- **デモ用**: 「30分会議仮置き」モックボタン（オプション機能）

## 4. 非機能要件

### 4.1 パフォーマンス要件
- **レスポンス時間**: UI操作に対して1秒以内の応答
- **バッチ処理**: HP計算処理は15分以内に完了
- **API呼び出し**: 天気API 1日1回、Vertex AI 必要時のみ

### 4.2 可用性要件
- **稼働率**: 審査期間中99%以上
- **障害復旧**: 自動復旧機能（Cloud Functions）
- **データ保持**: Firestore自動バックアップ

### 4.3 セキュリティ要件
- **個人情報**: PII最小化設計
- **データ保護**: GCP標準セキュリティ機能適用
- **認証**: 初期は匿名、将来OAuth2.0対応

### 4.4 運用要件
- **コスト上限**: $300クーポン内運用
- **ログ監視**: Cloud Logging活用
- **設定管理**: Remote Config対応

### 4.5 互換性要件
- **ブラウザ**: Chrome拡張MV3対応
- **OS**: プラットフォーム非依存
- **レスポンシブ**: 各種画面サイズ対応

## 5. 技術アーキテクチャ

### 5.1 フロントエンド
- **Chrome拡張**: Manifest V3
- **実装**: JavaScript + HTML + CSS
- **可視化**: SVGリング表示
- **設定画面**: Optionsページ

### 5.2 バックエンド（GCP）
- **実行基盤**: Firebase Cloud Functions v2
- **データベース**: Firestore
- **スケジューラ**: Cloud Scheduler
- **設定管理**: Remote Config（将来）
- **通知**: FCM（将来）
- **ログ**: Cloud Logging（将来）
- **ホスティング**: Firebase Hosting（必要時）

### 5.3 AI/ML（Google AI）
- **推論エンジン**: Vertex AI Gemini
  - 会議メタ推定
  - HP理由説明文生成
  - 提案文面生成
- **埋め込み**: Vertex Embeddings（v0.2以降）
  - 会議間文脈類似度算出
  - 切替コスト計算

### 5.4 外部API
- **天気データ**: Open-Meteo API（キー不要）

### 5.5 除外機能（MVP外）
- OAuth連携（Calendar/Gmail）
- Realtime Database購読
- 高度学習アルゴリズム

## 6. 開発制約・条件

### 6.1 ハッカソン制約
- **期間**: 提出 2025-09-24 JST、審査 9/25-10/8
- **必須要件**:
  - Google Cloud実行プロダクト ≥1個 → Functions/Firestore
  - GoogleのAI技術 ≥1個 → Vertex AI Gemini

### 6.2 提出物要件
- **コード**: GitHub公開リポジトリ
- **デプロイ**: 審査期間稼働URL
- **ドキュメント**: Zenn記事（課題・アーキテクチャ図・3分デモ）

### 6.3 受賞狙い
- **Firebase賞**: Realtime/Functions/Firestore活用
- **Tech Deep Dive賞**: Agentic設計×説明可能性

### 6.4 運用制約
- **公開期間**: 審査期間のみ
- **ロールバック**: 緊急時対応準備
- **係数調整**: Remote Config上限値設定

## 7. Remote Config設定項目

### 7.1 HP系数
```javascript
// 基本減衰
decay.base_per_15 = 0.5

// 会議タイプ係数
coef.type = {
  決定: 2.0, ブレスト: 2.5, 報告: 1.0, 1on1: 1.5,
  レビュー: 2.0, 企画: 2.0, 面談: 2.8, 
  ワークショップ: 2.2, 雑談: 0.8, 作業: 1.2
}

// その他係数
coef.length_scale = 0.2
coef.attendee_step = 0.2
coef.vague = 1.5
coef.context_e = 1.0
coef.travel_d = 0.4
```

### 7.2 閾値・回復設定
```javascript
// 閾値
break.threshold.caution = 40
break.threshold.warn = 25
break.threshold.critical = 10

// 回復量
break.recover.micro = 1     // per min
break.recover.lunch = 15
```

## 8. 今後の拡張予定（MVP後）

### 8.1 チーム機能
- HP信号灯共有（緑/黄/赤）
- 会議作成時の全員状況表示

### 8.2 高度な会議管理
- 会議延期・入札システム
- 不参加推奨（HP×役割判断）
- 参加者最適化提案

### 8.3 学習機能
- 個人HP減少パターン学習
- 会議効果性フィードバック
- カスタム係数自動調整

---

**文書作成日**: 2025-08-27  
**バージョン**: v1.0 MVP版